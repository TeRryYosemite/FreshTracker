generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-1.1.x", "debian-openssl-3.0.x", "linux-musl", "linux-musl-openssl-3.0.x", "rhel-openssl-1.0.x", "rhel-openssl-1.1.x", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id                Int      @id @default(autoincrement())
  username          String
  email             String   @unique
  password          String
  avatar            String?  @db.Text
  qqEmail           String?
  enableEmailNotify Boolean  @default(false)
  registerDate      DateTime @default(now())
  role              String   @default("user") // "user" or "admin"
  foods             Food[]
  records           Record[]
  memos             Memo[]
}

model Food {
  id             Int      @id @default(autoincrement())
  name           String
  category       String
  quantity       Int      @default(1)
  purchaseDate   DateTime
  expirationDate DateTime
  image          String?  @db.LongText
  tags           String?  @db.Text // Comma separated tags: "frozen,spicy"
  notes          String?  @db.Text
  userId         Int
  user           User     @relation(fields: [userId], references: [id])
}

model Record {
  id         Int      @id @default(autoincrement())
  foodName   String
  image      String?  @db.LongText
  quantity   Int
  reason     String
  returnDate DateTime
  timestamp  DateTime @default(now())
  userId     Int
  user       User     @relation(fields: [userId], references: [id])
  foodId     Int? // Optional relation to Food
}

// 新增验证码表
model VerificationCode {
  id        Int      @id @default(autoincrement())
  email     String
  code      String
  type      String // 例如: "register", "reset_password"
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@index([email])
}

model Memo {
  id        Int      @id @default(autoincrement())
  content   String
  completed Boolean  @default(false)
  createdAt DateTime @default(now())
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
}
